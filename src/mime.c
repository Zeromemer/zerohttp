#include <string.h>

// generated by https://gist.github.com/Zeromemer/238c57bcd91609759b1633eeb9d7ad2d
char *mime_db[][2] = {
	// most used
	{ "html", "text/html; charset=utf-8" },
	{ "htm", "text/html; charset=utf-8" },
	{ "shtml", "text/html; charset=utf-8" },
	{ "css", "text/css; charset=utf-8" },
	{ "js", "application/javascript; charset=utf-8" },
	{ "mjs", "application/javascript; charset=utf-8" },
	{ "json", "application/json; charset=utf-8" },
	{ "map", "application/json; charset=utf-8" },

	// text
	{ "scss", "text/x-scss" },
	{ "csv", "text/csv" },
	{ "jade", "text/jade" },
	{ "jsx", "text/jsx" },
	{ "less", "text/less" },
	{ "markdown", "text/markdown" },
	{ "md", "text/markdown" },
	{ "mml", "text/mathml" },
	{ "mdx", "text/mdx" },
	{ "n3", "text/n3; charset=utf-8" },
	{ "txt", "text/plain" },
	{ "text", "text/plain" },
	{ "conf", "text/plain" },
	{ "def", "text/plain" },
	{ "list", "text/plain" },
	{ "log", "text/plain" },
	{ "in", "text/plain" },
	{ "ini", "text/plain" },
	{ "dsc", "text/prs.lines.tag" },
	{ "rtx", "text/richtext" },
	{ "sgml", "text/sgml" },
	{ "sgm", "text/sgml" },
	{ "shex", "text/shex" },
	{ "slim", "text/slim" },
	{ "slm", "text/slim" },
	{ "spdx", "text/spdx" },
	{ "stylus", "text/stylus" },
	{ "styl", "text/stylus" },
	{ "tsv", "text/tab-separated-values" },
	{ "t", "text/troff" },
	{ "tr", "text/troff" },
	{ "roff", "text/troff" },
	{ "man", "text/troff" },
	{ "me", "text/troff" },
	{ "ms", "text/troff" },
	{ "ttl", "text/turtle; charset=utf-8" },
	{ "uri", "text/uri-list" },
	{ "uris", "text/uri-list" },
	{ "urls", "text/uri-list" },
	{ "vcard", "text/vcard" },
	{ "curl", "text/vnd.curl" },
	{ "dcurl", "text/vnd.curl.dcurl" },
	{ "mcurl", "text/vnd.curl.mcurl" },
	{ "scurl", "text/vnd.curl.scurl" },
	{ "ged", "text/vnd.familysearch.gedcom" },
	{ "fly", "text/vnd.fly" },
	{ "flx", "text/vnd.fmi.flexstor" },
	{ "gv", "text/vnd.graphviz" },
	{ "3dml", "text/vnd.in3d.3dml" },
	{ "spot", "text/vnd.in3d.spot" },
	{ "jad", "text/vnd.sun.j2me.app-descriptor; charset=utf-8" },
	{ "wml", "text/vnd.wap.wml" },
	{ "wmls", "text/vnd.wap.wmlscript" },
	{ "vtt", "text/vtt; charset=utf-8" },
	{ "s", "text/x-asm" },
	{ "asm", "text/x-asm" },
	{ "c", "text/x-c" },
	{ "cc", "text/x-c" },
	{ "cxx", "text/x-c" },
	{ "cpp", "text/x-c" },
	{ "h", "text/x-c" },
	{ "hh", "text/x-c" },
	{ "dic", "text/x-c" },
	{ "htc", "text/x-component" },
	{ "f", "text/x-fortran" },
	{ "for", "text/x-fortran" },
	{ "f77", "text/x-fortran" },
	{ "f90", "text/x-fortran" },
	{ "hbs", "text/x-handlebars-template" },
	{ "java", "text/x-java-source" },
	{ "lua", "text/x-lua" },
	{ "mkd", "text/x-markdown" },
	{ "nfo", "text/x-nfo" },
	{ "opml", "text/x-opml" },
	{ "p", "text/x-pascal" },
	{ "pas", "text/x-pascal" },
	{ "pde", "text/x-processing" },
	{ "sass", "text/x-sass" },
	{ "etx", "text/x-setext" },
	{ "sfv", "text/x-sfv" },
	{ "ymp", "text/x-suse-ymp" },
	{ "uu", "text/x-uuencode" },
	{ "vcs", "text/x-vcalendar" },
	{ "vcf", "text/x-vcard" },
	{ "yaml", "text/yaml" },
	{ "yml", "text/yaml" },

	// media
	{ "exr", "image/aces" },
	{ "apng", "image/apng" },
	{ "avci", "image/avci" },
	{ "avcs", "image/avcs" },
	{ "avif", "image/avif" },
	{ "bmp", "image/bmp" },
	{ "cgm", "image/cgm" },
	{ "drle", "image/dicom-rle" },
	{ "fits", "image/fits" },
	{ "g3", "image/g3fax" },
	{ "gif", "image/gif" },
	{ "heic", "image/heic" },
	{ "heics", "image/heic-sequence" },
	{ "heif", "image/heif" },
	{ "heifs", "image/heif-sequence" },
	{ "hej2", "image/hej2k" },
	{ "hsj2", "image/hsj2" },
	{ "ief", "image/ief" },
	{ "jls", "image/jls" },
	{ "jp2", "image/jp2" },
	{ "jpg2", "image/jp2" },
	{ "jpeg", "image/jpeg" },
	{ "jpg", "image/jpeg" },
	{ "jpe", "image/jpeg" },
	{ "jph", "image/jph" },
	{ "jhc", "image/jphc" },
	{ "jpm", "image/jpm" },
	{ "jpx", "image/jpx" },
	{ "jpf", "image/jpx" },
	{ "jxr", "image/jxr" },
	{ "jxra", "image/jxra" },
	{ "jxrs", "image/jxrs" },
	{ "jxs", "image/jxs" },
	{ "jxsc", "image/jxsc" },
	{ "jxsi", "image/jxsi" },
	{ "jxss", "image/jxss" },
	{ "ktx", "image/ktx" },
	{ "ktx2", "image/ktx2" },
	{ "png", "image/png" },
	{ "btif", "image/prs.btif" },
	{ "pti", "image/prs.pti" },
	{ "sgi", "image/sgi" },
	{ "svg", "image/svg+xml" },
	{ "svgz", "image/svg+xml" },
	{ "t38", "image/t38" },
	{ "tif", "image/tiff" },
	{ "tiff", "image/tiff" },
	{ "tfx", "image/tiff-fx" },
	{ "psd", "image/vnd.adobe.photoshop" },
	{ "azv", "image/vnd.airzip.accelerator.azv" },
	{ "uvi", "image/vnd.dece.graphic" },
	{ "uvvi", "image/vnd.dece.graphic" },
	{ "uvg", "image/vnd.dece.graphic" },
	{ "uvvg", "image/vnd.dece.graphic" },
	{ "djvu", "image/vnd.djvu" },
	{ "djv", "image/vnd.djvu" },
	{ "sub", "image/vnd.dvb.subtitle" },
	{ "dwg", "image/vnd.dwg" },
	{ "dxf", "image/vnd.dxf" },
	{ "fbs", "image/vnd.fastbidsheet" },
	{ "fpx", "image/vnd.fpx" },
	{ "fst", "image/vnd.fst" },
	{ "mmr", "image/vnd.fujixerox.edmics-mmr" },
	{ "rlc", "image/vnd.fujixerox.edmics-rlc" },
	{ "ico", "image/vnd.microsoft.icon" },
	{ "dds", "image/vnd.ms-dds" },
	{ "mdi", "image/vnd.ms-modi" },
	{ "wdp", "image/vnd.ms-photo" },
	{ "npx", "image/vnd.net-fpx" },
	{ "b16", "image/vnd.pco.b16" },
	{ "tap", "image/vnd.tencent.tap" },
	{ "vtf", "image/vnd.valve.source.texture" },
	{ "wbmp", "image/vnd.wap.wbmp" },
	{ "xif", "image/vnd.xiff" },
	{ "pcx", "image/vnd.zbrush.pcx" },
	{ "webp", "image/webp" },
	{ "3ds", "image/x-3ds" },
	{ "ras", "image/x-cmu-raster" },
	{ "cmx", "image/x-cmx" },
	{ "fh", "image/x-freehand" },
	{ "fhc", "image/x-freehand" },
	{ "fh4", "image/x-freehand" },
	{ "fh5", "image/x-freehand" },
	{ "fh7", "image/x-freehand" },
	{ "jng", "image/x-jng" },
	{ "sid", "image/x-mrsid-image" },
	{ "pic", "image/x-pict" },
	{ "pct", "image/x-pict" },
	{ "pnm", "image/x-portable-anymap" },
	{ "pbm", "image/x-portable-bitmap" },
	{ "pgm", "image/x-portable-graymap" },
	{ "ppm", "image/x-portable-pixmap" },
	{ "rgb", "image/x-rgb" },
	{ "tga", "image/x-tga" },
	{ "xbm", "image/x-xbitmap" },
	{ "xpm", "image/x-xpixmap" },
	{ "xwd", "image/x-xwindowdump" },
	{ "3gpp", "audio/3gpp" },
	{ "adp", "audio/adpcm" },
	{ "amr", "audio/amr" },
	{ "au", "audio/basic" },
	{ "snd", "audio/basic" },
	{ "mid", "audio/midi" },
	{ "midi", "audio/midi" },
	{ "kar", "audio/midi" },
	{ "rmi", "audio/midi" },
	{ "mxmf", "audio/mobile-xmf" },
	{ "mp3", "audio/mp3" },
	{ "m4a", "audio/mp4" },
	{ "mp4a", "audio/mp4" },
	{ "mpga", "audio/mpeg" },
	{ "mp2", "audio/mpeg" },
	{ "mp2a", "audio/mpeg" },
	{ "m2a", "audio/mpeg" },
	{ "m3a", "audio/mpeg" },
	{ "oga", "audio/ogg" },
	{ "ogg", "audio/ogg" },
	{ "spx", "audio/ogg" },
	{ "opus", "audio/ogg" },
	{ "s3m", "audio/s3m" },
	{ "sil", "audio/silk" },
	{ "uva", "audio/vnd.dece.audio" },
	{ "uvva", "audio/vnd.dece.audio" },
	{ "eol", "audio/vnd.digital-winds" },
	{ "dra", "audio/vnd.dra" },
	{ "dts", "audio/vnd.dts" },
	{ "dtshd", "audio/vnd.dts.hd" },
	{ "lvp", "audio/vnd.lucent.voice" },
	{ "pya", "audio/vnd.ms-playready.media.pya" },
	{ "ecelp4800", "audio/vnd.nuera.ecelp4800" },
	{ "ecelp7470", "audio/vnd.nuera.ecelp7470" },
	{ "ecelp9600", "audio/vnd.nuera.ecelp9600" },
	{ "rip", "audio/vnd.rip" },
	{ "wav", "audio/wav" },
	{ "weba", "audio/webm" },
	{ "aac", "audio/x-aac" },
	{ "aif", "audio/x-aiff" },
	{ "aiff", "audio/x-aiff" },
	{ "aifc", "audio/x-aiff" },
	{ "caf", "audio/x-caf" },
	{ "flac", "audio/x-flac" },
	{ "mka", "audio/x-matroska" },
	{ "m3u", "audio/x-mpegurl" },
	{ "wax", "audio/x-ms-wax" },
	{ "wma", "audio/x-ms-wma" },
	{ "ram", "audio/x-pn-realaudio" },
	{ "ra", "audio/x-pn-realaudio" },
	{ "rmp", "audio/x-pn-realaudio-plugin" },
	{ "xm", "audio/xm" },
	{ "3gp", "video/3gpp" },
	{ "3g2", "video/3gpp2" },
	{ "h261", "video/h261" },
	{ "h263", "video/h263" },
	{ "h264", "video/h264" },
	{ "m4s", "video/iso.segment" },
	{ "jpgv", "video/jpeg" },
	{ "jpgm", "video/jpm" },
	{ "mj2", "video/mj2" },
	{ "mjp2", "video/mj2" },
	{ "ts", "video/mp2t" },
	{ "mp4", "video/mp4" },
	{ "mp4v", "video/mp4" },
	{ "mpg4", "video/mp4" },
	{ "mpeg", "video/mpeg" },
	{ "mpg", "video/mpeg" },
	{ "mpe", "video/mpeg" },
	{ "m1v", "video/mpeg" },
	{ "m2v", "video/mpeg" },
	{ "ogv", "video/ogg" },
	{ "qt", "video/quicktime" },
	{ "mov", "video/quicktime" },
	{ "uvh", "video/vnd.dece.hd" },
	{ "uvvh", "video/vnd.dece.hd" },
	{ "uvm", "video/vnd.dece.mobile" },
	{ "uvvm", "video/vnd.dece.mobile" },
	{ "uvp", "video/vnd.dece.pd" },
	{ "uvvp", "video/vnd.dece.pd" },
	{ "uvs", "video/vnd.dece.sd" },
	{ "uvvs", "video/vnd.dece.sd" },
	{ "uvv", "video/vnd.dece.video" },
	{ "uvvv", "video/vnd.dece.video" },
	{ "dvb", "video/vnd.dvb.file" },
	{ "fvt", "video/vnd.fvt" },
	{ "mxu", "video/vnd.mpegurl" },
	{ "m4u", "video/vnd.mpegurl" },
	{ "pyv", "video/vnd.ms-playready.media.pyv" },
	{ "uvu", "video/vnd.uvvu.mp4" },
	{ "uvvu", "video/vnd.uvvu.mp4" },
	{ "viv", "video/vnd.vivo" },
	{ "webm", "video/webm" },
	{ "f4v", "video/x-f4v" },
	{ "fli", "video/x-fli" },
	{ "flv", "video/x-flv" },
	{ "m4v", "video/x-m4v" },
	{ "mkv", "video/x-matroska" },
	{ "mk3d", "video/x-matroska" },
	{ "mks", "video/x-matroska" },
	{ "mng", "video/x-mng" },
	{ "asf", "video/x-ms-asf" },
	{ "asx", "video/x-ms-asf" },
	{ "vob", "video/x-ms-vob" },
	{ "wm", "video/x-ms-wm" },
	{ "wmv", "video/x-ms-wmv" },
	{ "wmx", "video/x-ms-wmx" },
	{ "wvx", "video/x-ms-wvx" },
	{ "avi", "video/x-msvideo" },
	{ "movie", "video/x-sgi-movie" },
	{ "smv", "video/x-smv" },

	// misc
	{ "pdf", "application/pdf" },
	{ "pptx", "application/vnd.openxmlformats-officedocument.presentationml.presentation" },
	{ "sldx", "application/vnd.openxmlformats-officedocument.presentationml.slide" },
	{ "ppsx", "application/vnd.openxmlformats-officedocument.presentationml.slideshow" },
	{ "potx", "application/vnd.openxmlformats-officedocument.presentationml.template" },
	{ "xlsx", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" },
	{ "xltx", "application/vnd.openxmlformats-officedocument.spreadsheetml.template" },
	{ "docx", "application/vnd.openxmlformats-officedocument.wordprocessingml.document" },
	{ "dotx", "application/vnd.openxmlformats-officedocument.wordprocessingml.template" },
	{ "otc", "application/vnd.oasis.opendocument.chart-template" },
	{ "odb", "application/vnd.oasis.opendocument.database" },
	{ "odf", "application/vnd.oasis.opendocument.formula" },
	{ "odft", "application/vnd.oasis.opendocument.formula-template" },
	{ "odg", "application/vnd.oasis.opendocument.graphics" },
	{ "otg", "application/vnd.oasis.opendocument.graphics-template" },
	{ "odi", "application/vnd.oasis.opendocument.image" },
	{ "oti", "application/vnd.oasis.opendocument.image-template" },
	{ "odp", "application/vnd.oasis.opendocument.presentation" },
	{ "otp", "application/vnd.oasis.opendocument.presentation-template" },
	{ "ods", "application/vnd.oasis.opendocument.spreadsheet" },
	{ "ots", "application/vnd.oasis.opendocument.spreadsheet-template" },
	{ "odt", "application/vnd.oasis.opendocument.text" },
	{ "odm", "application/vnd.oasis.opendocument.text-master" },
	{ "ott", "application/vnd.oasis.opendocument.text-template" },
	{ "oth", "application/vnd.oasis.opendocument.text-web" },
	{ "zip", "application/zip" },
};

char *ext_to_mime(char *ext) {
    for (int i = 0; i < sizeof(mime_db) / sizeof(mime_db[0]); i++) {
        if (!strcmp(mime_db[i][0], ext)) {
            return mime_db[i][1];
        }
    }
    
    return "application/octet-stream";
}

char *path_to_mime(char *path) {
    int file_path_len = strlen(path);

    char *last_segment = path;
    for (int i = 0; i < file_path_len; i++) {
        if (path[i] == '/') last_segment = path + i;
    }

    int last_segment_len = strlen(last_segment);
    char *ext = NULL;
    for (int i = 0; i < last_segment_len; i++) {
        if (last_segment[i] == '.') ext = last_segment + i + 1;
    }

    if (!ext) return "application/octet-stream";

    return ext_to_mime(ext);
}